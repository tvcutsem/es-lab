{var Function,RegExp,WeakMap,atLeastFreeVarNames,cajaVM,eval,whitelist;(function(global){'use strict';var
afterFailures,apply,beforeFailures,call,complaint,concat,defProp,getPrototypeOf,hop,kludges,objToString,repairs,slice;function
log(str){typeof console!=='undefined'&&'log'in console&&console.log(str)}if(!Object.getOwnPropertyNames)throw complaint='Please upgrade to a JavaScript platform which implements Object.getOwnPropertyNames',log(complaint),new
EvalError(complaint);function test_GLOBAL_LEAKS(){var v=({}).valueOf,that='dummy';try{that=v()}catch(err){return err
instanceof TypeError?false:(log('New symptom: valueOf() threw '+err),true)}return true}function
test_MISSING_FREEZE_ETC(){return!('freeze'in Object)}function test_MISSING_CALLEE_DESCRIPTOR(){function
foo(){}return Object.getOwnPropertyNames(foo).indexOf('callee')<0?false:(foo.hasOwnProperty('callee')&&log('New symptom: empty strict function has own callee'),true)}function
test_REGEXP_CANT_BE_NEUTERED(){var deletion;if(!RegExp.hasOwnProperty('leftContext'))return false;try{deletion=delete
RegExp.leftContext}catch(err){return err instanceof TypeError||log('New symptom: deletion failed with '+err),true}return RegExp.hasOwnProperty('leftContext')?(deletion&&log('New symptom: Deletion of RegExp.leftContext failed.'),true):false}function
test_REGEXP_TEST_EXEC_UNSAFE(){var match;return/foo/.test('xfoox'),match=(new RegExp('(.|\r|\n)*','').exec())[0],match==='undefined'?false:(match!=='xfoox'&&log('New symptom: regExp.exec() does not match against \"undefined\".'),true)}function
test_MISSING_BIND(){return!('bind'in Function.prototype)}function test_MUTABLE_DATE_PROTO(){var
v;try{Date.prototype.setFullYear(1957)}catch(err){return err instanceof TypeError?false:(log('New symptom: Mutating Date.prototype failed with '+err),true)}return v=Date.prototype.getFullYear(),v!==v&&typeof
v==='number'?false:(v!==1957&&log('New symptom: Mutating Date.prototype did not throw'),true)}function
test_MUTABLE_WEAKMAP_PROTO(){var v,x;if(typeof WeakMap!=='function')return false;x={};try{WeakMap.prototype.set(x,86)}catch(err){return err
instanceof TypeError?false:(log('New symptom: Mutating WeakMap.prototype failed with '+err),true)}return v=WeakMap.prototype.get(x),v!==86&&log('New symptom: Mutating WeakMap.prototype did not throw'),true}function
test_NEED_TO_WRAP_FOREACH(){if(!('freeze'in Object))return false;try{return['z'].forEach(function(){Object.freeze(Array.prototype.forEach)}),false}catch(err){return err
instanceof TypeError||log('New Symptom: freezing forEach failed with '+err),true}}function
test_NEEDS_DUMMY_SETTER(){return typeof navigator!=='undefined'&&/Chrome/.test(navigator.userAgent)}function
test_ACCESSORS_INHERIT_AS_OWN(){var base={},derived=Object.create(base);function
getter(){return'gotten'}return Object.defineProperty(base,'foo',{'get':getter}),!derived.hasOwnProperty('foo')&&Object.getOwnPropertyDescriptor(derived,'foo')===void
0&&Object.getOwnPropertyNames(derived).indexOf('foo')<0?false:((!derived.hasOwnProperty('foo')||Object.getOwnPropertyDescriptor(derived,'foo').get!==getter||Object.getOwnPropertyNames(derived).indexOf('foo')<0)&&log('New symptom: Accessor properties partially inherit as own properties.'),Object.defineProperty(base,'bar',{'get':getter,'configurable':true}),!derived.hasOwnProperty('bar')&&Object.getOwnPropertyDescriptor(derived,'bar')===void
0&&Object.getOwnPropertyNames(derived).indexOf('bar')<0||log('New symptom: Accessor properties inherit as own even if configurable.'),true)}function
test_SORT_LEAKS_GLOBAL(){var that='dummy';return[2,3].sort(function(x,y){return that=this,x-y}),that===void
0?false:(that!==global&&log('New symptom: sort called comparefn with \"this\" === '+that),true)}function
test_REPLACE_LEAKS_GLOBAL(){var that='dummy';return'x'.replace(/x/,function(){return that=this,'y'}),that===void
0?false:(that!==global&&log('New symptom: replace called replaceValue function with \"this\" === '+that),true)}function
has(base,name,baseDesc){var result=void 0;try{result=name in base}catch(err){return log('New symptom (a): (\''+name+'\' in <'+baseDesc+'>) threw: '+err),result=false,false}finally{result===void
0&&log('New symptom (b): (\''+name+'\' in <'+baseDesc+'>) failed')}return!!result}function
has2(base,name,baseDesc){var result;try{result=has(base,name,baseDesc)}catch(err){return log('New symptom (c): (\''+name+'\' in <'+baseDesc+'>) threw: '+err),result=false,false}finally{result===void
0&&log('New symptom (d): (\''+name+'\' in <'+baseDesc+'>) failed')}return!!result}function
test_BUILTIN_LEAKS_CALLER(){var map=Array.prototype.map,caller,testfn;if(!has(map,'caller','a builtin'))return false;try{delete
map.caller}catch(err){}if(!has(map,'caller','a builtin'))return false;function foo(){return map.caller}testfn=Function('f','return [1].map(f)[0];');try{caller=testfn(foo)}catch(err){return err
instanceof TypeError?false:(log('New symptom: builtin \"caller\" failed with: '+err),true)}return[testfn,void
0,null].indexOf(caller)>=0?false:(log('New symptom: Unexpected \"caller\": '+caller),true)}function
test_BUILTIN_LEAKS_ARGUMENTS(){var map=Array.prototype.map,args,testfn;if(!has(map,'arguments','a builtin'))return false;try{delete
map.arguments}catch(err){}if(!has(map,'arguments','a builtin'))return false;function
foo(){return map.arguments}testfn=Function('f','return [1].map(f)[0];');try{args=testfn(foo)}catch(err){return err
instanceof TypeError?false:(log('New symptom: builtin \"arguments\" failed with: '+err),true)}return!(args===void
0||args===null)}function test_BOUND_FUNCTION_LEAKS_CALLER(){var bar,caller,testfn;if(!('bind'in
Function.prototype))return false;function foo(){return bar.caller}bar=foo.bind({});if(!has2(bar,'caller','a bound function'))return false;try{delete
bar.caller}catch(err){}if(!has2(bar,'caller','a bound function'))return log('New symptom: \"caller\" on bound functions can be deleted.'),true;testfn=Function('f','return f();');try{caller=testfn(bar)}catch(err){return err
instanceof TypeError?false:(log('New symptom: bound function \"caller\" failed with: '+err),true)}return[testfn,void
0,null].indexOf(caller)>=0?false:(log('New symptom: Unexpected \"caller\": '+caller),true)}function
test_BOUND_FUNCTION_LEAKS_ARGUMENTS(){var args,bar,testfn;if(!('bind'in Function.prototype))return false;function
foo(){return bar.arguments}bar=foo.bind({});if(!has2(bar,'arguments','a bound function'))return false;try{delete
bar.arguments}catch(err){}if(!has2(bar,'arguments','a bound function'))return log('New symptom: \"arguments\" on bound functions can be deleted.'),true;testfn=Function('f','return f();');try{args=testfn(bar)}catch(err){return err
instanceof TypeError?false:(log('New symptom: bound function \"arguments\" failed with: '+err),true)}return!(args===void
0||args===null)}function test_JSON_PARSE_PROTO_CONFUSION(){var x=JSON.parse('{\"__proto__\":[]}');return Object.getPrototypeOf(x)!==Object.prototype?true:Array.isArray(x.__proto__)?false:(log('New symptom: JSON.parse did not set \"__proto__\" as a regular property'),true)}call=Function.prototype.call,apply=Function.prototype.apply,hop=Object.prototype.hasOwnProperty,objToString=Object.prototype.toString,slice=Array.prototype.slice,concat=Array.prototype.concat,defProp=Object.defineProperty,getPrototypeOf=Object.getPrototypeOf;function
repair_MISSING_CALLEE_DESCRIPTOR(){var realGOPN=Object.getOwnPropertyNames;Object.getOwnPropertyNames=function
calleeFix(base){var result=realGOPN(base),i;return typeof base==='function'&&(i=result.indexOf('callee'),i>=0&&!hop.call(base,'callee')&&result.splice(i,1)),result}}function
repair_REGEXP_CANT_BE_NEUTERED(){var UnsafeRegExp=RegExp,FakeRegExp=function FakeRegExp(pattern,flags){switch(arguments.length){case
0:return UnsafeRegExp();case 1:return UnsafeRegExp(pattern);default:return UnsafeRegExp(pattern,flags)}};FakeRegExp.prototype=UnsafeRegExp.prototype,FakeRegExp.prototype.constructor=FakeRegExp,RegExp=FakeRegExp}function
repair_REGEXP_TEST_EXEC_UNSAFE(){var unsafeRegExpExec=RegExp.prototype.exec,unsafeRegExpTest;unsafeRegExpExec.call=call,unsafeRegExpTest=RegExp.prototype.test,unsafeRegExpTest.call=call,RegExp.prototype.exec=function
fakeExec(specimen){return unsafeRegExpExec.call(this,String(specimen))},RegExp.prototype.test=function
fakeTest(specimen){return unsafeRegExpTest.call(this,String(specimen))}}function
patchMissingProp(base,name,missingFunc){name in base||defProp(base,name,{'value':missingFunc,'writable':true,'enumerable':false,'configurable':true})}function
repair_MISSING_FREEZE_ETC(){patchMissingProp(Object,'freeze',function fakeFreeze(obj){return obj}),patchMissingProp(Object,'seal',function
fakeSeal(obj){return obj}),patchMissingProp(Object,'preventExtensions',function
fakePreventExtensions(obj){return obj}),patchMissingProp(Object,'isFrozen',function
fakeIsFrozen(obj){return false}),patchMissingProp(Object,'isSealed',function fakeIsSealed(obj){return false}),patchMissingProp(Object,'isExtensible',function
fakeIsExtensible(obj){return true})}function repair_MISSING_BIND(){patchMissingProp(Function.prototype,'bind',function
fakeBind(self,var_args){var thisFunc=this,leftArgs=slice.call(arguments,1);function
funcBound(var_args){var args=concat.call(leftArgs,slice.call(arguments,0));return apply.call(thisFunc,self,args)}return delete
funcBound.prototype,funcBound})}function makeMutableProtoPatcher(constr,classString){var
proto=constr.prototype,baseToString=objToString.call(proto);if(baseToString!=='[object '+classString+']')throw new
TypeError('unexpected: '+baseToString);if(getPrototypeOf(proto)!==Object.prototype)throw new
TypeError('unexpected inheritance: '+classString);function mutableProtoPatcher(name){var
originalMethod;if(!hop.call(proto,name))return;originalMethod=proto[name],originalMethod.apply=apply;function
replacement(var_args){var parent=getPrototypeOf(this),thisToString;if(objToString.call(parent)!==baseToString)throw thisToString=objToString.call(this),thisToString===baseToString?new
TypeError('May not mutate internal state of a '+classString+'.prototype'):new TypeError('Unexpected: '+thisToString);return originalMethod.apply(this,arguments)}defProp(proto,name,{'value':replacement})}return mutableProtoPatcher}function
repair_MUTABLE_DATE_PROTO(){['setYear','setTime','setFullYear','setUTCFullYear','setMonth','setUTCMonth','setDate','setUTCDate','setHours','setUTCHours','setMinutes','setUTCMinutes','setSeconds','setUTCSeconds','setMilliseconds','setUTCMilliseconds'].forEach(makeMutableProtoPatcher(Date,'Date'))}function
repair_MUTABLE_WEAKMAP_PROTO(){['set','delete'].forEach(makeMutableProtoPatcher(WeakMap,'WeakMap'))}function
repair_NEED_TO_WRAP_FOREACH(){(function(){var forEach=Array.prototype.forEach;defProp(Array.prototype,'forEach',{'value':function
forEachWrapper(callbackfn,opt_thisArg){return apply.call(forEach,this,arguments)}})})()}function
repair_NEEDS_DUMMY_SETTER(){(function(){var defProp=Object.defineProperty,gopd=Object.getOwnPropertyDescriptor,freeze=Object.freeze,complained=false;defProp(Object,'defineProperty',{'value':function(base,name,desc){var
fullDesc,oldDesc,testBase;function dummySetter(newValue){if(name==='ident___')complained||(log('Undiagnosed call to setter for ident___'),complained=true);else
throw new TypeError('Cannot set \".'+name+'\"')}return freeze(dummySetter.prototype),freeze(dummySetter),oldDesc=gopd(base,name),testBase={},oldDesc&&defProp(testBase,name,oldDesc),defProp(testBase,name,desc),fullDesc=gopd(testBase,name),'get'in
fullDesc&&fullDesc.set===void 0&&(fullDesc.set=dummySetter),defProp(base,name,fullDesc)}})})()}function
repair_ACCESSORS_INHERIT_AS_OWN(){(function(){var defProp=Object.defineProperty,freeze=Object.freeze,seal=Object.seal,gopn=Object.getOwnPropertyNames,gopd=Object.getOwnPropertyDescriptor,complaint='Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=637994  prohibits enumerable non-configurable accessor properties.';function
isBadAccessor(derived,name){var desc=gopd(derived,name),base,superDesc;return!desc||!('get'in
desc)?false:(base=getPrototypeOf(derived),base?(superDesc=gopd(base,name),!superDesc||!('get'in
superDesc)?false:desc.get&&!desc.configurable&&!superDesc.configurable&&desc.get===superDesc.get&&desc.set===superDesc.set&&desc.enumerable===superDesc.enumerable):false)}defProp(Object,'defineProperty',{'value':function
definePropertyWrapper(base,name,desc){var oldDesc=gopd(base,name),testBase={},fullDesc;oldDesc&&!isBadAccessor(base,name)&&defProp(testBase,name,oldDesc),defProp(testBase,name,desc),fullDesc=gopd(testBase,name);if('get'in
fullDesc&&fullDesc.enumerable&&!fullDesc.configurable)throw log(complaint),new TypeError(complaint);return defProp(base,name,fullDesc)}});function
ensureSealable(base){gopn(base).forEach(function(name){var desc=gopd(base,name);if('get'in
desc&&desc.enumerable)throw desc.configurable||log('New symptom: \"'+name+'\" already non-configurable'),log(complaint),new
TypeError(complaint)})}defProp(Object,'freeze',{'value':function freezeWrapper(base){return ensureSealable(base),freeze(base)}}),defProp(Object,'seal',{'value':function
sealWrapper(base){return ensureSealable(base),seal(base)}}),defProp(Object.prototype,'hasOwnProperty',{'value':function
hasOwnPropertyWrapper(name){return hop.call(this,name)&&!isBadAccessor(this,name)}}),defProp(Object,'getOwnPropertyDescriptor',{'value':function
getOwnPropertyDescriptorWrapper(base,name){return isBadAccessor(base,name)?void 0:gopd(base,name)}}),defProp(Object,'getOwnPropertyNames',{'value':function
getOwnPropertyNamesWrapper(base){return gopn(base).filter(function(name){return!isBadAccessor(base,name)})}})})()}function
repair_SORT_LEAKS_GLOBAL(){(function(){var unsafeSort=Array.prototype.sort;unsafeSort.call=call;function
sortWrapper(opt_comparefn){function comparefnWrapper(x,y){return opt_comparefn(x,y)}return arguments.length===0?unsafeSort.call(this):unsafeSort.call(this,comparefnWrapper)}defProp(Array.prototype,'sort',{'value':sortWrapper})})()}function
repair_REPLACE_LEAKS_GLOBAL(){(function(){var unsafeReplace=String.prototype.replace;unsafeReplace.call=call;function
replaceWrapper(searchValue,replaceValue){var safeReplaceValue=replaceValue;function
replaceValueWrapper(m1,m2,m3){return replaceValue(m1,m2,m3)}return typeof replaceValue==='function'&&(safeReplaceValue=replaceValueWrapper),unsafeReplace.call(this,searchValue,safeReplaceValue)}defProp(String.prototype,'replace',{'value':replaceWrapper})})()}kludges=[{'description':'Global object leaks through built-in methods','test':test_GLOBAL_LEAKS,'repair':void
0,'canRepairSafely':false,'urls':['https://bugs.webkit.org/show_bug.cgi?id=51097','https://bugs.webkit.org/show_bug.cgi?id=58338','http://code.google.com/p/v8/issues/detail?id=1437'],'sections':['15.2.4.4'],'tests':['S15.2.4.4_A14']},{'description':'Object.freeze is missing','test':test_MISSING_FREEZE_ETC,'repair':repair_MISSING_FREEZE_ETC,'canRepairSafely':false,'urls':['https://bugs.webkit.org/show_bug.cgi?id=55736'],'sections':['15.2.3.9'],'tests':[]},{'description':'Phantom callee on strict functions','test':test_MISSING_CALLEE_DESCRIPTOR,'repair':repair_MISSING_CALLEE_DESCRIPTOR,'canRepairSafely':true,'urls':['https://bugs.webkit.org/show_bug.cgi?id=55537'],'sections':['15.2.3.4'],'tests':[]},{'description':'Cannot delete ambient mutable RegExp.leftContext','test':test_REGEXP_CANT_BE_NEUTERED,'repair':repair_REGEXP_CANT_BE_NEUTERED,'canRepairSafely':true,'urls':['https://bugzilla.mozilla.org/show_bug.cgi?id=591846','http://wiki.ecmascript.org/doku.php?id=conventions:make_non-standard_properties_configurable'],'sections':[],'tests':[]},{'description':'RegExp.exec leaks match globally','test':test_REGEXP_TEST_EXEC_UNSAFE,'repair':repair_REGEXP_TEST_EXEC_UNSAFE,'canRepairSafely':true,'urls':['http://code.google.com/p/v8/issues/detail?id=1393','http://code.google.com/p/chromium/issues/detail?id=75740','https://bugzilla.mozilla.org/show_bug.cgi?id=635017','http://code.google.com/p/google-caja/issues/detail?id=528'],'sections':['15.10.6.2'],'tests':['S15.10.6.2_A12']},{'description':'Function.prototype.bind is missing','test':test_MISSING_BIND,'repair':repair_MISSING_BIND,'canRepairSafely':true,'urls':['https://bugs.webkit.org/show_bug.cgi?id=26382'],'sections':['15.3.4.5'],'tests':[]},{'description':'Date.prototype is a global communication channel','test':test_MUTABLE_DATE_PROTO,'repair':repair_MUTABLE_DATE_PROTO,'canRepairSafely':true,'urls':['http://code.google.com/p/google-caja/issues/detail?id=1362'],'sections':['15.9.5'],'tests':[]},{'description':'WeakMap.prototype is a global communication channel','test':test_MUTABLE_WEAKMAP_PROTO,'repair':repair_MUTABLE_WEAKMAP_PROTO,'canRepairSafely':true,'urls':['https://bugzilla.mozilla.org/show_bug.cgi?id=656828'],'sections':[],'tests':[]},{'description':'Array forEach cannot be frozen while in progress','test':test_NEED_TO_WRAP_FOREACH,'repair':repair_NEED_TO_WRAP_FOREACH,'canRepairSafely':true,'urls':['http://code.google.com/p/v8/issues/detail?id=1447'],'sections':['15.4.4.18'],'tests':['S15.4.4.18_A1','S15.4.4.18_A2']},{'description':'Workaround undiagnosed need for dummy setter','test':test_NEEDS_DUMMY_SETTER,'repair':repair_NEEDS_DUMMY_SETTER,'canRepairSafely':true,'urls':[],'sections':[],'tests':[]},{'description':'Accessor properties inherit as own properties','test':test_ACCESSORS_INHERIT_AS_OWN,'repair':repair_ACCESSORS_INHERIT_AS_OWN,'canRepairSafely':true,'urls':['https://bugzilla.mozilla.org/show_bug.cgi?id=637994'],'sections':[],'tests':[]},{'description':'Array sort leaks global','test':test_SORT_LEAKS_GLOBAL,'repair':repair_SORT_LEAKS_GLOBAL,'canRepairSafely':true,'urls':['http://code.google.com/p/v8/issues/detail?id=1360'],'sections':['15.4.4.11'],'tests':['S15.4.4.11_A8']},{'description':'String replace leaks global','test':test_REPLACE_LEAKS_GLOBAL,'repair':repair_REPLACE_LEAKS_GLOBAL,'canRepairSafely':true,'urls':['http://code.google.com/p/v8/issues/detail?id=1360'],'sections':['15.5.4.11'],'tests':['S15.5.4.11_A12']},{'description':'Built in functions leak \"caller\"','test':test_BUILTIN_LEAKS_CALLER,'repair':void
0,'canRepairSafely':false,'urls':['https://bugzilla.mozilla.org/show_bug.cgi?id=591846','http://wiki.ecmascript.org/doku.php?id=conventions:make_non-standard_properties_configurable'],'sections':[],'tests':[]},{'description':'Built in functions leak \"arguments\"','test':test_BUILTIN_LEAKS_ARGUMENTS,'repair':void
0,'canRepairSafely':false,'urls':['https://bugzilla.mozilla.org/show_bug.cgi?id=591846','http://wiki.ecmascript.org/doku.php?id=conventions:make_non-standard_properties_configurable'],'sections':[],'tests':[]},{'description':'Bound functions leak \"caller\"','test':test_BOUND_FUNCTION_LEAKS_CALLER,'repair':repair_MISSING_BIND,'canRepairSafely':true,'urls':['http://code.google.com/p/v8/issues/detail?id=893','https://bugs.webkit.org/show_bug.cgi?id=63398'],'sections':['15.3.4.5'],'tests':['S15.3.4.5_A1']},{'description':'Bound functions leak \"arguments\"','test':test_BOUND_FUNCTION_LEAKS_ARGUMENTS,'repair':repair_MISSING_BIND,'canRepairSafely':true,'urls':['http://code.google.com/p/v8/issues/detail?id=893','https://bugs.webkit.org/show_bug.cgi?id=63398'],'sections':['15.3.4.5'],'tests':['S15.3.4.5_A2']},{'description':'JSON.parse confused by \"__proto__\"','test':test_JSON_PARSE_PROTO_CONFUSION,'repair':void
0,'canRepairSafely':true,'urls':['http://code.google.com/p/v8/issues/detail?id=621','http://code.google.com/p/v8/issues/detail?id=1310'],'sections':['15.12.2'],'tests':['S15.12.2_A1']}],beforeFailures=kludges.map(function(kludge){return kludge.test()}),repairs=[],kludges.forEach(function(kludge,i){var
repair;beforeFailures[i]&&(repair=kludge.repair,repair&&repairs.lastIndexOf(repair)===-1&&(repair(),repairs.push(repair)))}),afterFailures=kludges.map(function(kludge){return kludge.test()}),kludges.forEach(function(kludge,i){var
status='';if(beforeFailures[i])afterFailures[i]?kludge.repair?(status='Repair failed'):(status='Not repaired'):kludge.repair?(status='Repaired'):(status='Accidentally repaired');else
if(afterFailures[i])status='Broken by other attempted repairs';else return;log(i+': '+kludge.description+'. '+status+'. '+(kludge.canRepairSafely?'':'This platform is not SES-safe. ')+(kludge.urls[0]?'See '+kludge.urls[0]:''))})})(this),(function(){'use strict';var
NO_IDENT,defProp,gopn,hop,originalProps;if(typeof WeakMap==='function')return;hop=Object.prototype.hasOwnProperty,gopn=Object.getOwnPropertyNames,defProp=Object.defineProperty,originalProps={},gopn(Object).forEach(function(name){originalProps[name]=Object[name]}),NO_IDENT='noident:0';function
identity(key){var desc,name;function identGetter(){return name}if(key!==Object(key))throw new
TypeError('Not an object: '+key);return desc=originalProps.getOwnPropertyDescriptor(key,'ident___'),desc?desc.get:originalProps.isExtensible(key)?(name='hash:'+Math.random(),originalProps.freeze(identGetter.prototype),originalProps.freeze(identGetter),defProp(key,'ident___',{'get':identGetter,'set':undefined,'enumerable':false,'configurable':false}),identGetter):NO_IDENT}function
identifyFirst(base,name){var oldFunc=base[name];defProp(base,name,{'value':function(obj,var_args){return identity(obj),oldFunc.apply(this,arguments)}})}identifyFirst(Object,'freeze'),identifyFirst(Object,'seal'),identifyFirst(Object,'preventExtensions'),identifyFirst(Object,'defineProperty'),identifyFirst(Object,'defineProperties'),defProp(Object,'getOwnPropertyNames',{'value':function
fakeGetOwnPropertyNames(obj){var result=gopn(obj),i=result.indexOf('ident___');return i>=0&&result.splice(i,1),result}}),defProp(Object,'getOwnPropertyDescriptor',{'value':function
fakeGetOwnPropertyDescriptor(obj,name){return name==='ident___'?undefined:originalProps.getOwnPropertyDescriptor(obj,name)}}),'getPropertyNames'in
Object&&defProp(Object,'getPropertyNames',{'value':function fakeGetPropertyNames(obj){var
result=originalProps.getPropertyNames(obj),i=result.indexOf('ident___');return i>=0&&result.splice(i,1),result}}),'getPropertyDescriptor'in
Object&&defProp(Object,'getPropertyDescriptor',{'value':function fakeGetPropertyDescriptor(obj,name){return name==='ident___'?undefined:originalProps.getPropertyDescriptor(obj,name)}}),defProp(Object,'create',{'value':function
fakeCreate(parent,pdmap){var result=originalProps.create(parent);return identity(result),pdmap&&originalProps.defineProperties(result,pdmap),result}});function
constFunc(func){return Object.freeze(func.prototype),Object.freeze(func)}WeakMap=function
WeakMap(){var identities={},values={};function find(key){var id=identity(key),i,name,opt_ids;return typeof
id==='string'?(name=id,id=key):(name=id()),opt_ids=identities[name],i=opt_ids?opt_ids.indexOf(id):-1,originalProps.freeze({'name':name,'id':id,'opt_ids':opt_ids,'i':i})}function
get___(key,opt_default){var f=find(key);return f.i>=0?values[f.name][f.i]:opt_default}function
has___(key){return find(key).i>=0}function set___(key,value){var f=find(key),ids=f.opt_ids||(identities[f.name]=[]),vals=values[f.name]||(values[f.name]=[]),i=f.i>=0?f.i:ids.length;ids[i]=f.id,vals[i]=value}function
delete___(key){var f=find(key),ids,last,vals;return f.i<0?false:(ids=f.opt_ids,last=ids.length-1,last===0?(delete
identities[f.name],delete values[f.name]):(vals=values[f.name],ids[f.i]=ids[last],vals[f.i]=vals[last],ids.splice(last),vals.splice(last)),true)}return Object.create(WeakMap.prototype,{'get___':{'value':constFunc(get___)},'has___':{'value':constFunc(has___)},'set___':{'value':constFunc(set___)},'delete___':{'value':constFunc(delete___)}})},WeakMap.prototype=Object.create(Object.prototype,{'get':{'value':function
get(key,opt_default){return this.get___(key,opt_default)},'writable':true,'configurable':true},'has':{'value':function
has(key){return this.has___(key)},'writable':true,'configurable':true},'set':{'value':function
set(key,value){this.set___(key,value)},'writable':true,'configurable':true},'delete':{'value':function
remove(key){return this.delete___(key)},'writable':true,'configurable':true}})})(),(function(){'use strict';var
s,t;t=true,s='skip',whitelist={'cajaVM':{'log':t,'def':t,'compile':t,'compileModule':t,'eval':t,'Function':t},'Q':{'get':t,'post':t,'put':t,'delete':t,'when':t,'defer':t,'reject':t,'ref':t,'near':t,'defined':t,'run':t,'Promise':t,'isPromise':t,'def':t},'WeakMap':{'prototype':{'get':t,'set':t,'has':t,'delete':t}},'Proxy':{'create':t,'createFunction':t},'escape':t,'unescape':t,'Object':{'getPropertyDescriptor':t,'getPropertyNames':t,'identical':t,'prototype':{'constructor':'*','toString':'*','toLocaleString':'*','valueOf':t,'hasOwnProperty':t,'isPrototypeOf':t,'propertyIsEnumerable':t},'getPrototypeOf':t,'getOwnPropertyDescriptor':t,'getOwnPropertyNames':t,'create':t,'defineProperty':t,'defineProperties':t,'seal':t,'freeze':t,'preventExtensions':t,'isSealed':t,'isFrozen':t,'isExtensible':t,'keys':t},'NaN':t,'Infinity':t,'undefined':t,'parseInt':t,'parseFloat':t,'isNaN':t,'isFinite':t,'decodeURI':t,'decodeURIComponent':t,'encodeURI':t,'encodeURIComponent':t,'Function':{'prototype':{'apply':t,'call':t,'bind':t,'prototype':'*','length':'*','caller':s,'arguments':s,'arity':s,'name':s}},'Array':{'prototype':{'concat':t,'join':t,'pop':t,'push':t,'reverse':t,'shift':t,'slice':t,'sort':t,'splice':t,'unshift':t,'indexOf':t,'lastIndexOf':t,'every':t,'some':t,'forEach':t,'map':t,'filter':t,'reduce':t,'reduceRight':t,'length':s},'isArray':t},'String':{'prototype':{'substr':t,'anchor':t,'big':t,'blink':t,'bold':t,'fixed':t,'fontcolor':t,'fontsize':t,'italics':t,'link':t,'small':t,'strike':t,'sub':t,'sup':t,'trimLeft':t,'trimRight':t,'valueOf':t,'charAt':t,'charCodeAt':t,'concat':t,'indexOf':t,'lastIndexOf':t,'localeCompare':t,'match':t,'replace':t,'search':t,'slice':t,'split':t,'substring':t,'toLowerCase':t,'toLocaleLowerCase':t,'toUpperCase':t,'toLocaleUpperCase':t,'trim':t,'length':s},'fromCharCode':t},'Boolean':{'prototype':{'valueOf':t}},'Number':{'prototype':{'valueOf':t,'toFixed':t,'toExponential':t,'toPrecision':t},'MAX_VALUE':t,'MIN_VALUE':t,'NaN':t,'NEGATIVE_INFINITY':t,'POSITIVE_INFINITY':t},'Math':{'E':t,'LN10':t,'LN2':t,'LOG2E':t,'LOG10E':t,'PI':t,'SQRT1_2':t,'SQRT2':t,'abs':t,'acos':t,'asin':t,'atan':t,'atan2':t,'ceil':t,'cos':t,'exp':t,'floor':t,'log':t,'max':t,'min':t,'pow':t,'random':t,'round':t,'sin':t,'sqrt':t,'tan':t},'Date':{'prototype':{'getYear':t,'setYear':t,'toGMTString':t,'toDateString':t,'toTimeString':t,'toLocaleString':t,'toLocaleDateString':t,'toLocaleTimeString':t,'getTime':t,'getFullYear':t,'getUTCFullYear':t,'getMonth':t,'getUTCMonth':t,'getDate':t,'getUTCDate':t,'getDay':t,'getUTCDay':t,'getHours':t,'getUTCHours':t,'getMinutes':t,'getUTCMinutes':t,'getSeconds':t,'getUTCSeconds':t,'getMilliseconds':t,'getUTCMilliseconds':t,'getTimezoneOffset':t,'setTime':t,'setFullYear':t,'setUTCFullYear':t,'setMonth':t,'setUTCMonth':t,'setDate':t,'setUTCDate':t,'setHours':t,'setUTCHours':t,'setMinutes':t,'setUTCMinutes':t,'setSeconds':t,'setUTCSeconds':t,'setMilliseconds':t,'setUTCMilliseconds':t,'toUTCString':t,'toISOString':t,'toJSON':t},'parse':t,'UTC':t,'now':t},'RegExp':{'prototype':{'exec':t,'test':t,'source':s,'global':s,'ignoreCase':s,'multiline':s,'lastIndex':s,'sticky':s}},'Error':{'prototype':{'name':'*','message':'*'}},'EvalError':{'prototype':t},'RangeError':{'prototype':t},'ReferenceError':{'prototype':t},'SyntaxError':{'prototype':t},'TypeError':{'prototype':t},'URIError':{'prototype':t},'JSON':{'parse':t,'stringify':t}}})(),(function(){'use strict';function
LIMIT_SRC(programSrc){if(/[^\u0000-\u007f]/.test(programSrc))throw new EvalError('Non-ascii text not yet supported');if(/\\u/.test(programSrc))throw new
EvalError('Backslash-u escape encoded text not yet supported')}function SHOULD_MATCH_IDENTIFIER(){return/(\w|\$)+/g}atLeastFreeVarNames=function
atLeastFreeVarNames(programSrc){var a,name,regexp,result;programSrc=String(programSrc),LIMIT_SRC(programSrc),regexp=SHOULD_MATCH_IDENTIFIER(),result=Object.create(null);while(a=regexp.exec(programSrc))name=a[0],result[name]=true;return result}})();function
startSES(global,whitelist,atLeastFreeVarNames){'use strict';var REQUIRE_STRICT,TAME_GLOBAL_EVAL,badDeletions,cantNeuter,cleaning,complaint,dirty,goodDeletions,hop,root,skipped,whiteTable;REQUIRE_STRICT=false,TAME_GLOBAL_EVAL=false,dirty=true,hop=Object.prototype.hasOwnProperty;function
fail(str){debugger;throw new EvalError(str)}typeof WeakMap==='undefined'&&fail('No built-in WeakMaps, so WeakMap.js must be loaded first'),REQUIRE_STRICT&&(function(){return this})()&&fail('Requires at least ES5 support'),root=Object.create(null),(function(){var
unsafeEval=eval,UnsafeFunction=Function,defended,directivePattern,requirePattern;function
verifyStrictProgram(programSrc){UnsafeFunction('\"use strict\";'+programSrc)}function
verifyStrictExpression(exprSrc){verifyStrictProgram(exprSrc+';'),verifyStrictProgram('( '+exprSrc+'\n);')}function
initGlobalProperties(from,virtualGlobal){Object.getOwnPropertyNames(from).forEach(function(name){var
desc=Object.getOwnPropertyDescriptor(from,name);desc.enumerable=false,desc.configurable=true,Object.defineProperty(virtualGlobal,name,desc)})}function
makeVirtualGlobal(env){var virtualGlobal=Object.create(null);return initGlobalProperties(root,virtualGlobal),initGlobalProperties(env,virtualGlobal),Object.freeze(virtualGlobal)}function
makeScopeObject(virtualGlobal,freeNames){var scopeObject=Object.create(virtualGlobal);return Object.keys(freeNames).forEach(function(name){name
in virtualGlobal||Object.defineProperty(scopeObject,name,{'get':function(){throw new
ReferenceError('\"'+name+'\" not in scope')},'set':function(ignored){throw new TypeError('Cannot set \"'+name+'\"')}})}),Object.freeze(scopeObject)}function
compile(exprSrc){var freeNames,wrapper,wrapperSrc;return dirty&&fail('Initial cleaning failed'),verifyStrictExpression(exprSrc),freeNames=atLeastFreeVarNames(exprSrc),wrapperSrc='(function() {   with (this) {     return function() {       \"use strict\";       return (         '+exprSrc+'\n'+'      );\n'+'    };\n'+'  }\n'+'})',wrapper=unsafeEval(wrapperSrc),function(env){var
virtualGlobal=makeVirtualGlobal(env),scopeObject=makeScopeObject(virtualGlobal,freeNames);return wrapper.call(scopeObject).call(virtualGlobal)}}directivePattern=/^['"](?:\w|\s)*['"]$/m,requirePattern=/^(?:\w*\s*(?:\w|\$|\.)*\s*=\s*)?\s*require\s*\(\s*['"]((?:\w|\$|\.|\/)+)['"]\s*\)$/m;function
getRequirements(modSrc){var result=[],stmts=modSrc.split(';'),i=0,ilen=stmts.length,m,stmt;for(;i<ilen;++i){stmt=stmts[i].trim();if(stmt!==''){if(!directivePattern.test(stmt))break}}for(;i<ilen;++i){stmt=stmts[i].trim();if(stmt!==''){m=requirePattern.exec(stmt);if(!m)break;result.push(m[1])}}return Object.freeze(result)}function
compileModule(modSrc){var moduleMaker=compile('(function() {'+modSrc+'}).call(this)');return moduleMaker.requirements=getRequirements(modSrc),Object.freeze(moduleMaker.prototype),Object.freeze(moduleMaker)}function
FakeFunction(var_args){var params=[].slice.call(arguments,0),body=params.pop(),exprSrc;return body=String(body||''),params=params.join(','),exprSrc='(function('+params+'\n){'+body+'})',compile(exprSrc)({})}FakeFunction.prototype=UnsafeFunction.prototype,FakeFunction.prototype.constructor=FakeFunction,global.Function=FakeFunction;function
fakeEval(src){try{verifyStrictExpression(src)}catch(x){src='(function() {'+src+'\n}).call(this)'}return compile(src)({})}TAME_GLOBAL_EVAL&&(global.eval=fakeEval),defended=WeakMap();function
def(node){var defending=WeakMap(),defendingList=[];function recur(val){if(val!==Object(val)||defended.get(val)||defending.get(val))return;defending.set(val,true),defendingList.push(val),Object.freeze(val),recur(Object.getPrototypeOf(val)),Object.getOwnPropertyNames(val).forEach(function(p){var
desc;if(typeof val==='function'&&(p==='caller'||p==='arguments'))return;desc=Object.getOwnPropertyDescriptor(val,p),recur(desc.value),recur(desc.get),recur(desc.set)})}return recur(node),defendingList.forEach(function(obj){defended.set(obj,true)}),node}global.cajaVM={'log':function(str){typeof
console!=='undefined'&&'log'in console&&console.log(str)},'def':def,'compile':compile,'compileModule':compileModule,'eval':fakeEval,'Function':FakeFunction}})(),cantNeuter=[];function
read(base,name){var desc=Object.getOwnPropertyDescriptor(base,name),result;if(desc&&'value'in
desc&&!desc.writable&&!desc.configurable)return desc.value;result=base[name];try{Object.defineProperty(base,name,{'value':result,'writable':false,'configurable':false})}catch(ex){cantNeuter.push({'base':base,'name':name,'err':ex})}return result}Object.keys(whitelist).forEach(function(name){var
desc=Object.getOwnPropertyDescriptor(global,name),permit,value;desc&&(permit=whitelist[name],permit&&(value=read(global,name),Object.defineProperty(root,name,{'value':value,'writable':true,'enumerable':false,'configurable':false})))}),TAME_GLOBAL_EVAL&&Object.defineProperty(root,'eval',{'value':cajaVM.eval,'writable':true,'enumerable':false,'configurable':false}),whiteTable=WeakMap();function
register(value,permit){var oldPermit;if(value!==Object(value))return;if(typeof permit!=='object')return;oldPermit=whiteTable.get(value),oldPermit&&fail('primordial reachable through multiple paths'),whiteTable.set(value,permit),Object.keys(permit).forEach(function(name){var
sub;permit[name]!=='skip'&&(sub=read(value,name),register(sub,permit[name]))})}register(root,whitelist);function
getPermit(base,name){var permit=whiteTable.get(base),result;if(permit){if(permit[name])return permit[name]};while(true){base=Object.getPrototypeOf(base);if(base===null)return false;permit=whiteTable.get(base);if(permit&&hop.call(permit,name))return result=permit[name],result==='*'||result==='skip'?result:false}}cleaning=WeakMap(),skipped=[],goodDeletions=[],badDeletions=[];function
clean(value,prefix){if(value!==Object(value))return;if(cleaning.get(value))return;cleaning.set(value,true),Object.getOwnPropertyNames(value).forEach(function(name){var
path=prefix+(prefix?'.':'')+name,p=getPermit(value,name),sub,success;if(p)p==='skip'?skipped.push(path):(sub=read(value,name),clean(sub,path));else{try{success=delete
value[name]}catch(x){success=false}success?goodDeletions.push(path):badDeletions.push(path)}}),Object.freeze(value)}clean(root,'');function
reportDiagnosis(desc,problemList){return problemList.length===0?false:(cajaVM.log(desc+': '+problemList.sort().join(' ')),true)}reportDiagnosis('Deleted',goodDeletions),cantNeuter.length>=1&&(complaint=cantNeuter.map(function(p){var
desc=Object.getPropertyDescriptor(p.base,p.name);return desc?p.name+'('+p.err+'): '+Object.getOwnPropertyNames(desc).map(function(attrName){var
v=desc[attrName];return v===Object(v)&&(v='a '+typeof v),attrName+': '+v}).join(', '):'  Missing '+p.name}),reportDiagnosis('Cannot neuter',complaint));if(reportDiagnosis('Cannot delete',badDeletions))throw new
Error('Consult JS console log for deletion failures');cajaVM.log('success'),dirty=false}(function(global){'use strict';startSES(global,whitelist,atLeastFreeVarNames)})(this)}